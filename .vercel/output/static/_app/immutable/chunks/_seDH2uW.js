import{i as d,a as A,b as g}from"./Ce-RAqAn.js";function E(n){const c=I(n),s=new ArrayBuffer(c.length),a=new DataView(s);for(let o=0;o<s.byteLength;o++)a.setUint8(o,c.charCodeAt(o));return s}const T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function I(n){n.length%4===0&&(n=n.replace(/==?$/,""));let c="",s=0,a=0;for(let o=0;o<n.length;o++)s<<=6,s|=T.indexOf(n[o]),a+=6,a===24&&(c+=String.fromCharCode((s&16711680)>>16),c+=String.fromCharCode((s&65280)>>8),c+=String.fromCharCode(s&255),s=a=0);return a===12?(s>>=4,c+=String.fromCharCode(s)):a===18&&(s>>=2,c+=String.fromCharCode((s&65280)>>8),c+=String.fromCharCode(s&255)),c}const k=-1,C=-2,S=-3,N=-4,D=-5,L=-6;function U(n,c){return O(JSON.parse(n),c)}function O(n,c){if(typeof n=="number")return i(n,!0);if(!Array.isArray(n)||n.length===0)throw new Error("Invalid input");const s=n,a=Array(s.length);let o=null;function i(r,y=!1){if(r===k)return;if(r===S)return NaN;if(r===N)return 1/0;if(r===D)return-1/0;if(r===L)return-0;if(y||typeof r!="number")throw new Error("Invalid input");if(r in a)return a[r];const t=s[r];if(!t||typeof t!="object")a[r]=t;else if(Array.isArray(t))if(typeof t[0]=="string"){const l=t[0],u=c&&Object.hasOwn(c,l)?c[l]:void 0;if(u){let f=t[1];if(typeof f!="number"&&(f=s.push(t[1])-1),o??=new Set,o.has(f))throw new Error("Invalid circular reference");return o.add(f),a[r]=u(i(f)),o.delete(f),a[r]}switch(l){case"Date":a[r]=new Date(t[1]);break;case"Set":const f=new Set;a[r]=f;for(let e=1;e<t.length;e+=1)f.add(i(t[e]));break;case"Map":const b=new Map;a[r]=b;for(let e=1;e<t.length;e+=2)b.set(i(t[e]),i(t[e+1]));break;case"RegExp":a[r]=new RegExp(t[1],t[2]);break;case"Object":a[r]=Object(t[1]);break;case"BigInt":a[r]=BigInt(t[1]);break;case"null":const p=Object.create(null);a[r]=p;for(let e=1;e<t.length;e+=2)p[t[e]]=i(t[e+1]);break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{if(s[t[1]][0]!=="ArrayBuffer")throw new Error("Invalid data");const e=globalThis[l],m=i(t[1]),h=new e(m);a[r]=t[2]!==void 0?h.subarray(t[2],t[3]):h;break}case"ArrayBuffer":{const e=t[1];if(typeof e!="string")throw new Error("Invalid ArrayBuffer encoding");const m=E(e);a[r]=m;break}case"Temporal.Duration":case"Temporal.Instant":case"Temporal.PlainDate":case"Temporal.PlainTime":case"Temporal.PlainDateTime":case"Temporal.PlainMonthDay":case"Temporal.PlainYearMonth":case"Temporal.ZonedDateTime":{const e=l.slice(9);a[r]=Temporal[e].from(t[1]);break}case"URL":{const e=new URL(t[1]);a[r]=e;break}case"URLSearchParams":{const e=new URLSearchParams(t[1]);a[r]=e;break}default:throw new Error(`Unknown type ${l}`)}}else{const l=new Array(t.length);a[r]=l;for(let u=0;u<t.length;u+=1){const f=t[u];f!==C&&(l[u]=i(f))}}else{const l={};a[r]=l;for(const u in t){if(u==="__proto__")throw new Error("Cannot parse an object with a `__proto__` property");const f=t[u];l[u]=i(f)}}return a[r]}return i(0)}function B(n){const c=JSON.parse(n);return c.data&&(c.data=U(c.data,g.decoders)),c}function w(n){return HTMLElement.prototype.cloneNode.call(n)}function R(n,c=()=>{}){const s=async({action:o,result:i,reset:r=!0,invalidateAll:y=!0})=>{i.type==="success"&&(r&&HTMLFormElement.prototype.reset.call(n),y&&await d()),(location.origin+location.pathname===o.origin+o.pathname||i.type==="redirect"||i.type==="error")&&await A(i)};async function a(o){if((o.submitter?.hasAttribute("formmethod")?o.submitter.formMethod:w(n).method)!=="post")return;o.preventDefault();const r=new URL(o.submitter?.hasAttribute("formaction")?o.submitter.formAction:w(n).action),y=o.submitter?.hasAttribute("formenctype")?o.submitter.formEnctype:w(n).enctype,t=new FormData(n,o.submitter),l=new AbortController;let u=!1;const b=await c({action:r,cancel:()=>u=!0,controller:l,formData:t,formElement:n,submitter:o.submitter})??s;if(u)return;let p;try{const e=new Headers({accept:"application/json","x-sveltekit-action":"true"});y!=="multipart/form-data"&&e.set("Content-Type",/^(:?application\/x-www-form-urlencoded|text\/plain)$/.test(y)?y:"application/x-www-form-urlencoded");const m=y==="multipart/form-data"?t:new URLSearchParams(t),h=await fetch(r,{method:"POST",headers:e,cache:"no-store",body:m,signal:l.signal});p=B(await h.text()),p.type==="error"&&(p.status=h.status)}catch(e){if(e?.name==="AbortError")return;p={type:"error",error:e}}await b({action:r,formData:t,formElement:n,update:e=>s({action:r,result:p,reset:e?.reset,invalidateAll:e?.invalidateAll}),result:p})}return HTMLFormElement.prototype.addEventListener.call(n,"submit",a),{destroy(){HTMLFormElement.prototype.removeEventListener.call(n,"submit",a)}}}export{R as e};
